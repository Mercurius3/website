BEGIN:VCALENDAR
X-WR-CALNAME:<%= @product.name %>
METHOD:PUBLISH
VERSION:2.0
PRODID:-//<%= @product.name %>Calendar//EN
CALSCALE:GREGORIAN
<% @product.events.each do |event| %>
BEGIN:VEVENT
CLASS:PUBLIC
DTSTAMP:<%= Time.now.strftime("%Y%m%dT%H%M%SZ") %>
UID:<%= event.id %>
SEQUENCE:<%= Time.now.to_i %>
SUMMARY:<%= @product.name %> | <%= event.name %>
DTSTART:<%= event.datetime.strftime("%Y%m%dT%H%M%SZ") %>
<% event_end = event.datetime + event.duration %>
DTEND:<%= event_end.strftime("%Y%m%dT%H%M%SZ") %>
URL:<%= event_url(event) %>
END:VEVENT
<% end %>
END:VCALENDAR